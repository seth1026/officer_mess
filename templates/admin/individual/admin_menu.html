{% extends 'admin/layout.html' %}

{% block content %}
<div class="container content">
    <div class="section-header mb-4">
        <h1>Menu Management</h1>
        <p class="text-muted">Edit, add, or delete menu items for each section. Changes reflect on the public menu page instantly.</p>
    </div>

    {% for section in sections %}
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">{{ section.capitalize() }}</h5>
            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addModal{{ section }}">
                <i class="bi bi-plus-circle me-1"></i> Add Item
            </button>
        </div>
        <div class="card-body">
            {% if menu_data[section] %}
            <div class="table-responsive">
                <table class="table table-sticky">
                    <thead>
                        <tr>
                            {% if section == 'breakfast' %}<th>Day</th>{% endif %}
                            <th>Item Name</th>
                            <th>Price (₹)</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in menu_data[section] %}
                        <tr>
                            {% if section == 'breakfast' %}<td>{{ item.day or 'N/A' }}</td>{% endif %}
                            <td>{{ item.item_name }}</td>
                            <td>{{ item.price | round(2) }}</td>
                            <td>{{ item.description or 'None' }}</td>
                            <td>
                                <button type="button" class="btn btn-warning btn-sm me-1" data-bs-toggle="modal" data-bs-target="#editModal{{ item.id }}">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <form action="{{ url_for('admin_menu') }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="item_id" value="{{ item.id }}">
                                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this item?');">
                                        <i class="bi bi-trash"></i> Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center py-4">No items in this section yet. Add one above.</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

    <!-- Add Modals (one per section) -->
    {% for section in sections %}
    <div class="modal fade" id="addModal{{ section }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form action="{{ url_for('admin_menu') }}" method="POST">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Add New Item to {{ section.capitalize() }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="action" value="add">
                        <input type="hidden" name="section" value="{{ section }}">
                        {% if section == 'breakfast' %}
                        <div class="mb-3">
                            <label for="day_{{ section }}" class="form-label">Day</label>
                            <select name="day" id="day_{{ section }}" class="form-select" required>
                                <option value="">Select Day</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                                <option value="Sunday">Sunday</option>
                            </select>
                        </div>
                        {% endif %}
                        <div class="mb-3">
                            <label for="item_name_{{ section }}" class="form-label">Item Name</label>
                            <input type="text" name="item_name" id="item_name_{{ section }}" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="price_{{ section }}" class="form-label">Price (₹)</label>
                            <input type="number" name="price" id="price_{{ section }}" class="form-control" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="description_{{ section }}" class="form-label">Description</label>
                            <textarea name="description" id="description_{{ section }}" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- Edit Modals (one per item) -->
    {% for section in sections %}
        {% for item in menu_data[section] %}
    <div class="modal fade" id="editModal{{ item.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form action="{{ url_for('admin_menu') }}" method="POST">
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title">Edit Item: {{ item.item_name }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="action" value="edit">
                        <input type="hidden" name="item_id" value="{{ item.id }}">
                        {% if section == 'breakfast' %}
                        <div class="mb-3">
                            <label for="day_{{ item.id }}" class="form-label">Day</label>
                            <select name="day" id="day_{{ item.id }}" class="form-select" required>
                                <option value="">Select Day</option>
                                <option value="Monday" {% if item.day == 'Monday' %}selected{% endif %}>Monday</option>
                                <option value="Tuesday" {% if item.day == 'Tuesday' %}selected{% endif %}>Tuesday</option>
                                <option value="Wednesday" {% if item.day == 'Wednesday' %}selected{% endif %}>Wednesday</option>
                                <option value="Thursday" {% if item.day == 'Thursday' %}selected{% endif %}>Thursday</option>
                                <option value="Friday" {% if item.day == 'Friday' %}selected{% endif %}>Friday</option>
                                <option value="Saturday" {% if item.day == 'Saturday' %}selected{% endif %}>Saturday</option>
                                <option value="Sunday" {% if item.day == 'Sunday' %}selected{% endif %}>Sunday</option>
                            </select>
                        </div>
                        {% endif %}
                        <div class="mb-3">
                            <label for="item_name_{{ item.id }}" class="form-label">Item Name</label>
                            <input type="text" name="item_name" id="item_name_{{ item.id }}" class="form-control" value="{{ item.item_name }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="price_{{ item.id }}" class="form-label">Price (₹)</label>
                            <input type="number" name="price" id="price_{{ item.id }}" class="form-control" step="0.01" value="{{ item.price }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="description_{{ item.id }}" class="form-label">Description</label>
                            <textarea name="description" id="description_{{ item.id }}" class="form-control" rows="3">{{ item.description or '' }}</textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-warning">Update Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
        {% endfor %}
    {% endfor %}
</div>
{% endblock %}