{% extends 'public/layout.html' %}

{% block content %}
<div class="container my-5">
    <div class="jumbotron text-center py-5 bg-light rounded-3 mb-5">
        <h1 class="display-4 fw-bold text-primary">Gallery</h1>
        <p class="lead text-muted">A glimpse into our events, celebrations, and memorable moments.</p>
    </div>

    <!-- Category Tabs -->
    <ul class="nav nav-tabs justify-content-center mb-5" id="galleryTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-semibold fs-5 px-4" data-bs-toggle="tab" data-bs-target="#all" type="button">All</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold fs-5 px-4" data-bs-toggle="tab" data-bs-target="#retirement" type="button">Retirement</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold fs-5 px-4" data-bs-toggle="tab" data-bs-target="#festivals" type="button">Festivals</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold fs-5 px-4" data-bs-toggle="tab" data-bs-target="#parties" type="button">Parties</button>
        </li>
    </ul>

    <div class="tab-content">
        <!-- All Tab - One card per event_name -->
        <div class="tab-pane fade show active" id="all">
            {% set all_events = gallery_items | groupby('event_name') | sort(attribute='grouper', reverse=True) %}
            {% if all_events %}
            <div class="row g-4">
                {% for event_group in all_events %}
                {% set event_photos = event_group.list %}
                <div class="col-md-6 col-lg-4">
                    <a href="{{ url_for('gallery_event', event_name=event_group.grouper) }}" class="text-decoration-none">
                        <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden hover-lift">
                            <img src="{{ url_for('static', filename='uploads/' + event_photos[0].filename) }}" 
                                 class="card-img-top" 
                                 alt="{{ event_group.grouper }}" 
                                 style="height: 250px; object-fit: cover;">
                            <div class="card-body text-center bg-white">
                                <h5 class="card-title fw-bold text-primary mb-2">{{ event_group.grouper }}</h5>
                                <p class="text-muted small">{{ event_photos|length }} photos</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <p class="text-muted fs-4">No photos available yet.</p>
            </div>
            {% endif %}
        </div>

        <!-- Category Tabs - One card per event_name in that category -->
        {% set categories = ['retirement', 'festivals', 'parties'] %}
        {% for cat in categories %}
        <div class="tab-pane fade" id="{{ cat }}">
            {% set cat_events = gallery_items | selectattr('category', 'equalto', cat) | groupby('event_name') | sort(attribute='grouper', reverse=True) %}
            {% if cat_events %}
            <div class="row g-4">
                {% for event_group in cat_events %}
                {% set event_photos = event_group.list %}
                <div class="col-md-6 col-lg-4">
                    <a href="{{ url_for('gallery_event', event_name=event_group.grouper) }}" class="text-decoration-none">
                        <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden hover-lift">
                            <img src="{{ url_for('static', filename='uploads/' + event_photos[0].filename) }}" 
                                 class="card-img-top" 
                                 alt="{{ event_group.grouper }}" 
                                 style="height: 250px; object-fit: cover;">
                            <div class="card-body text-center bg-white">
                                <h5 class="card-title fw-bold text-primary mb-2">{{ event_group.grouper }}</h5>
                                <p class="text-muted small">{{ event_photos|length }} photos</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <p class="text-muted fs-4">No photos in this category yet.</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        font-weight: 600;
        padding: 12px 30px;
    }
    .nav-tabs .nav-link.active {
        color: #001f3f;
        border-bottom: 4px solid #d4af37;
        background: transparent;
    }
    .hover-lift {
        transition: all 0.4s ease;
    }
    .hover-lift:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 31, 63, 0.15);
    }
</style>
{% endblock %}